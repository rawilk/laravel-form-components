{"version":3,"file":"form-components.js","sources":["../resources/js/util/findLastIndex.js","../resources/js/components/index.js","../resources/js/components/custom-select.js"],"sourcesContent":["export default (array, predicate) => {\n    let l = array.length;\n    while (l--) {\n        if (predicate(array[l], l, array)) {\n            return l;\n        }\n    }\n\n    return -1;\n};\n","import customSelect from './custom-select';\n\nwindow.customSelect = customSelect;\n","/*\n * Custom Select Component Definition.\n *\n * Note: Not using polyfills for functions such as Array.from()\n * since I use Livewire, and Livewire already includes polyfills\n * for those functions. If you don't use Livewire, you should\n * make sure are pulling in those polyfills.\n */\n\nimport findLastIndex from '../util/findLastIndex';\n\nexport default function customSelect(state) {\n    return {\n        ...state,\n\n        display: '',\n        options: [],\n        currentIndex: -1,\n        query: '',\n\n        get activeDescendant() {\n            return this.currentIndex > -1\n                ? `listbox-${this.selectId}-item-${this.currentIndex}`\n                : null;\n        },\n\n        get hasValue() {\n            return this.multiple\n                ? this.value.length > 0\n                : Boolean(this.value);\n        },\n\n        get enabledLength() {\n            return this.options.filter(o => ! o.disabled && ! o.hidden).length;\n        },\n\n        get placeholderMarkup() {\n            return `<span class=\"custom-select--placeholder\">${this.placeholder}</span>`;\n        },\n\n        init($watch) {\n            this.options = this.parseOptions();\n\n            if (this.value && this.multiple && ! Array.isArray(this.value)) {\n                this.value = [this.value];\n            }\n\n            this.updateDisplay(this.value);\n\n            $watch('value', value => this.updateDisplay(value));\n            $watch('query', value => this.filter(value));\n            $watch('wireFilter', () => {\n                this.$nextTick(() => {\n                    this.options = this.parseOptions();\n                });\n            });\n\n            $watch('selected', value => this.onSelectedChanged(value));\n        },\n\n        filter(value) {\n            const optionsToHide = this.options\n                .filter(o => {\n                    o.hidden = false;\n\n                    return ! String(o.value).toLowerCase().includes(value) && ! String(o.text).toLowerCase().includes(value);\n                })\n                .map(o => {\n                    o.hidden = true;\n\n                    return this.optionIndex(o.value);\n                });\n\n            if (! optionsToHide.length) {\n                Array.from(this.$refs.menu.children).forEach(child => child.classList.remove('hidden'));\n\n                return;\n            }\n\n            Array.from(this.$refs.menu.children)\n                .forEach(child => {\n                    const index = Number(child.dataset.index);\n\n                    if (optionsToHide.includes(index)) {\n                        child.classList.add('hidden');\n                    } else {\n                        child.classList.remove('hidden');\n                    }\n                });\n        },\n\n        parseOptions() {\n            return Array.from(this.$refs.menu.children)\n                .filter(child => child.classList.contains('custom-select--option'))\n                .map((child, index) => {\n                    child.setAttribute('data-index', index);\n                    child.setAttribute('id', `listbox-${this.selectId}-item-${index}`);\n\n                    return JSON.parse(child.dataset.option)\n                });\n        },\n\n        isChosen(value) {\n            if (this.multiple) {\n                if (! Array.isArray(this.value)) {\n                    this.value = [this.value];\n                }\n\n                return this.value.includes(value);\n            }\n\n            return value === this.value;\n        },\n\n        chooseForMultiple(value) {\n            if (! this.isChosen(value)) {\n                this.value.push(value);\n            } else if (this.optional || this.value.length > 1) {\n                this.value.splice(this.value.indexOf(value), 1);\n                this.updateDisplay(this.value);\n            }\n\n            if (this.value.length === 0) {\n                this.closeMenu();\n            }\n        },\n\n        clear() {\n            this.value = this.multiple ? [] : null;\n        },\n\n        choose(value) {\n            if (this.multiple) {\n                return this.chooseForMultiple(value);\n            }\n\n            this.value = (this.optional && this.value === value)\n                ? null\n                : value;\n\n            this.closeMenu();\n        },\n\n        closeMenu() {\n            this.open = false;\n            this.focusButton();\n        },\n\n        onOptionSelect() {\n            if (this.currentIndex < 0) {\n                return;\n            }\n\n            const option = this.options[this.currentIndex];\n\n            if (option && ! option.disabled) {\n                this.choose(option.value);\n            }\n        },\n\n        // Excludes any \"optgroup\" elements\n        optionChildren() {\n            return Array.from(this.$refs.menu.children)\n                .filter(child => child.classList.contains('custom-select--option'));\n        },\n\n        updateDisplay(value) {\n            if (! value) {\n                return this.display = this.placeholderMarkup;\n            }\n\n            if (this.multiple) {\n                return this.updateDisplayForMultiple(value);\n            }\n\n            const $li = this.optionChildren()[this.optionIndex(value)];\n            this.display = $li\n                ? $li.children[0].innerHTML\n                : this.placeholderMarkup;\n        },\n\n        updateDisplayForMultiple(value) {\n            const length = value.length;\n            if (length === 0) {\n                return this.display = this.placeholderMarkup;\n            }\n\n            const $li = this.optionChildren()[this.optionIndex(value[0])];\n\n            if (! $li) {\n                return this.display = `${length} Selected`;\n            }\n\n            let display = $li.children[0].innerHTML;\n            if ((length - 1) > 0) {\n                display += `<span class=\"text-xs text-cool-gray-500\">+ ${length - 1}</span>`;\n            }\n\n            this.display = display;\n        },\n\n        optionIndex(value) {\n            return this.options.findIndex(o => o.value === value);\n        },\n\n        onMouseEnter(value) {\n            this.selected = value;\n            this.currentIndex = this.optionIndex(value);\n        },\n\n        onSelectedChanged(value) {\n            if (! this.open) {\n                return;\n            }\n\n            const index = this.optionIndex(value);\n\n            if (index < 0) {\n                return;\n            }\n\n            this.$nextTick(() => {\n                const $li = this.optionChildren()[index];\n\n                if (! $li) {\n                    return;\n                }\n\n                const filterHasFocus = this.filterable\n                    && document.activeElement === this.$refs.filter;\n\n                $li.focus();\n\n                if (filterHasFocus) {\n                    this.focusFilter();\n                }\n            });\n        },\n\n        onArrowUp() {\n            // If no enabled options, just return...\n            if (this.enabledLength === 0) {\n                this.currentIndex = -1;\n                this.selected = null;\n\n                return;\n            }\n\n            let prevIndex = findLastIndex(this.options, (o, index) => ! o.disabled && ! o.hidden && index < this.currentIndex);\n            if (prevIndex < 0) {\n                prevIndex = findLastIndex(this.options, o => ! o.disabled && ! o.hidden);\n            }\n\n            this.currentIndex = prevIndex;\n            this.selected = this.options[this.currentIndex].value;\n        },\n\n        onArrowDown() {\n            // If no enabled options, just return...\n            if (this.enabledLength === 0) {\n                this.currentIndex = -1;\n                this.selected = null;\n\n                return;\n            }\n\n            let nextIndex = this.options.findIndex((o, index) => index > this.currentIndex && ! o.disabled && ! o.hidden);\n            if (nextIndex === -1 || (nextIndex + 1) > this.options.length) {\n                nextIndex = this.options.findIndex(o => ! o.disabled && ! o.hidden);\n            }\n\n            this.currentIndex = nextIndex;\n            this.selected = this.options[this.currentIndex].value;\n        },\n\n        onHome() {\n            // If no enabled options, just return...\n            if (this.enabledLength === 0) {\n                this.currentIndex = -1;\n                this.selected = null;\n\n                return;\n            }\n\n            this.currentIndex = this.options.findIndex(o => ! o.disabled && ! o.hidden);\n            this.selected = this.options[this.currentIndex].value;\n        },\n\n        onEnd() {\n            // If no enabled options, just return...\n            if (this.enabledLength === 0) {\n                this.currentIndex = -1;\n                this.selected = null;\n\n                return;\n            }\n\n            this.currentIndex = findLastIndex(this.options, o => ! o.disabled && ! o.hidden);\n            this.selected = this.options[this.currentIndex].value;\n        },\n\n        focusButton() {\n            this.$nextTick(() => this.$refs.button.focus());\n        },\n\n        focusFilter() {\n            this.$nextTick(() => this.$refs.filter.focus());\n        },\n\n        focusMenu() {\n            this.$nextTick(() => this.$refs.menu.focus());\n        },\n\n        onShiftTab() {\n            if (this.filterable) {\n                this.focusFilter();\n            } else {\n                this.closeMenu();\n            }\n        },\n\n        highlightSelectedOption() {\n            if (this.multiple) {\n                this.currentIndex = this.optionIndex(this.value[0]);\n            } else {\n                this.currentIndex = this.value\n                    ? this.optionIndex(this.value)\n                    : 0;\n            }\n\n            // Let's focus the first option if none of them are selected.\n            if (this.currentIndex < 0 && this.enabledLength > 0) {\n                this.currentIndex = 0;\n            }\n\n            this.selected = this.currentIndex > -1\n                ? this.options[this.currentIndex].value\n                : null;\n        },\n\n        toggle() {\n            this.open = ! this.open;\n\n            if (this.open) {\n                this.$nextTick(() => this.positionMenu());\n                this.highlightSelectedOption();\n                this[this.filterable ? 'focusFilter' : 'focusMenu']();\n            }\n        },\n\n        positionMenu() {\n            this.$refs.container.classList.remove('custom-menu-top');\n\n            // give a little bit of breathing room at the bottom of the screen.\n            const tolerance = 10;\n            const menuHeight = this.$refs.menu.offsetHeight;\n            const largestHeight = window.innerHeight - menuHeight - tolerance;\n\n            const { top } = this.$refs.menu.getBoundingClientRect();\n\n            if (top > largestHeight) {\n                this.$refs.container.classList.add('custom-menu-top');\n            }\n        },\n    };\n}\n"],"names":["array","predicate","l","length","window","customSelect","state","display","options","currentIndex","query","this","selectId","multiple","value","Boolean","filter","o","disabled","hidden","placeholder","init","$watch","parseOptions","Array","isArray","updateDisplay","_this","$nextTick","onSelectedChanged","optionsToHide","String","toLowerCase","includes","text","map","_this2","optionIndex","from","$refs","menu","children","forEach","child","index","Number","dataset","classList","add","remove","contains","setAttribute","_this3","JSON","parse","option","isChosen","chooseForMultiple","optional","splice","indexOf","push","closeMenu","clear","choose","open","focusButton","onOptionSelect","optionChildren","placeholderMarkup","updateDisplayForMultiple","$li","innerHTML","findIndex","onMouseEnter","selected","_this4","filterHasFocus","filterable","document","activeElement","focus","focusFilter","onArrowUp","enabledLength","prevIndex","findLastIndex","_this5","onArrowDown","nextIndex","_this6","onHome","onEnd","_this7","button","_this8","focusMenu","_this9","onShiftTab","highlightSelectedOption","toggle","_this10","positionMenu","container","menuHeight","offsetHeight","largestHeight","innerHeight","getBoundingClientRect","top"],"mappings":"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"}